#!/bin/sh
set -eu

if [ -z "${ROOT-}" ]; then
	cd "$(dirname "$0")/.."
	ROOT="$PWD"
fi

service_dir="$ROOT/etc/rc.d"

. "$ROOT/etc/rc.conf"
. "$ROOT/etc/rc.subr"

log_file="$ROOT/var/log/profileinit/messages"

services="$(find "$service_dir" -type f | sort)"

for service in $services; do
	service_short="$(basename "$service")"

	eval "do=\${${service_short}-}"

	case "$do" in
	YES)
		set -- start
		. "$service"
		;;
	esac
done

if [ -f "$ROOT/etc/rc.local" ]; then
	. "$ROOT/etc/rc.local"
fi

log "init complete"
