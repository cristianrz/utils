#!/bin/sh

set -eu

IDIR="$PWD"

dirname="$(dirname "$0")"
cd "$dirname"/.. || exit 1
ROOT="$PWD" export ROOT

init_restart() {
	init_stop
	cd "$IDIR"
	exec "$dirname/profileinit"
}

init_stop() {
	kill -15 "$sleep_pid"
	. "$ROOT/etc/rc.shutdown"
}

trap 'init_restart' 2
trap 'init_stop' 15

. "$ROOT/etc/rc"

# unless we do this, it doesn't react all signals
sleep infinity &
sleep_pid="$!"
wait
